<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./app.css">
    <link rel="stylesheet" href="./grid.css">
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet"/>
    <script src="https://kit.fontawesome.com/d890c03bb3.js" crossorigin="anonymous"></script>

    <style>
      :root {
        --main-color: #1f83ed;
        --body-bg: #181616;
        --box-bg: #221f1f;
        --text-color: #ffffff;
        --nav-height: 60px;
        --space-top: 30px;
      }

      *{
        scroll-behavior: smooth;
      }

      .main{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin-top: 50px;
      }

      .profile-image{
        height: 200px;
        width: 200px;
        border-radius: 50%;
        background-color: var(--text-color);
        border: 2px solid var(--text-color);
        margin-bottom: 10px;
      }

      .profile-image:hover{
        border-color: var(--main-color);
      }

      #submit-data-form{
        padding: 10px 20px;
        border-radius: 20px;
        border: 1px solid transparent;
        transition: .5s;
        cursor: pointer;
        margin: 10px 0;
        background-color: var(--main-color);
        color: var(--text-color);
        border-radius: 5px;
      }

      #submit-data-form:hover{
        background-color: transparent;
        color: var(--text-color);
        border-color: var(--main-color);
      }

      .faviorite-data{
        margin: 20px 0;
        padding: 0 50px;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 50px;
      }

      input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid var(--text-color);
        background-color: transparent;
        color: var(--text-color);
        border-radius: 5px;
      }

      input:hover{
        border-color: var(--main-color);
      }

      .user-data{
        padding: 0 50px;
        margin-top: 50px;
      }

      #username{
        margin-bottom: 10px;
      }

      .cards-container{
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
      }

      .card{
        border: 1px solid var(--main-color);
      }

      .card a h2{
        padding: 10px;
      }

      @media (max-width: 920px){
        .cards-container{
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 450px){
        .cards-container{
          grid-template-columns: repeat(1, 1fr);
        }
      }
    </style>
</head>
<body>
    <!-- NAV -->
    <div class="nav-wrapper">
        <div class="container">
          <div class="nav">
            <a href="/index.html" class="logo">
              <i class="bx bx-movie-play bx-tada main-color"></i>Fl<span
                class="main-color"
                >i</span
              >
            </a>
            <ul class="nav-menu" id="nav-menu">
              <li><a href="/">Home</a></li>
              <li><a href="#">Genre</a></li>
              <li><a href="#">Movies</a></li>
              <li><a href="#">Series</a></li>
              <li><a href="#">About</a></li>
              <li id="nav-auth">
                
              </li>
            </ul>
            <!-- MOBILE MENU TOGGLE -->
            <div class="hamburger-menu" id="hamburger-menu">
              <div class="hamburger"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- END NAV -->

      <!-- USER DATA -->
      <div class="main">
        <img src="#" id="profile-image" class="profile-image" alt="profile image">
        <div class="profile-data">
          <h1 id="username"></h1>
        </div>

        <form class="user-data" id="edit-form">
          <h2>Edit User Data Form</h2>
          <hr style="margin: 10px 0;">
          <label for="username">Username</label>
          <input type="text" name="username" id="username-form" required>

          <label for="email">Email</label>
          <input type="text" name="email" id="email-form" required>
          
          <label for="password">Password</label>
          <input type="password" name="password" id="password-form" required>
          
          <label for="confirm_password_form">Confirm Password</label>
          <input type="password" name="confirm_password_form" id="confirm_password_form" required>
          
          <button type="submit" id="submit-data-form">Edit Data</button>
        </form>
      </div>
      <!-- Faviorite Movies & Serieses-->
      <div class="faviorite-data">
        <h2>Faviorite Movies</h2>
        <hr style="margin: 10px 0; width: 100%;">
        <div class="cards-container" id="cards-container">

        </div>
      </div>

      <!-- FOOTER SECTION -->
      <footer class="section">
        <div class="container">
          <div class="row">
            <div class="col-4 col-md-6 col-sm-12">
              <div class="content">
                <a href="#" class="logo">
                  <i class="bx bx-movie-play bx-tada main-color"></i>Fl<span
                    class="main-color"
                    >i</span
                  >x
                </a>
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut
                  veniam ex quos hic id nobis beatae earum sapiente! Quod ipsa
                  exercitationem officiis non error illum minima iusto et.
                  Dolores, quibusdam?
                </p>
                <div class="social-list">
                  <a href="#" class="social-item">
                    <i class="bx bxl-facebook"></i>
                  </a>
                  <a href="#" class="social-item">
                    <i class="bx bxl-twitter"></i>
                  </a>
                  <a href="#" class="social-item">
                    <i class="bx bxl-instagram"></i>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-8 col-md-6 col-sm-12">
              <div class="row">
                <div class="col-3 col-md-6 col-sm-6">
                  <div class="content">
                    <p><b>Flix</b></p>
                    <ul class="footer-menu">
                      <li><a href="#">About us</a></li>
                      <li><a href="#">My profile</a></li>
                      <li><a href="#">Pricing plans</a></li>
                      <li><a href="#">Contacts</a></li>
                    </ul>
                  </div>
                </div>
                <div class="col-3 col-md-6 col-sm-6">
                  <div class="content">
                    <p><b>Browse</b></p>
                    <ul class="footer-menu">
                      <li><a href="#">About us</a></li>
                      <li><a href="#">My profile</a></li>
                      <li><a href="#">Pricing plans</a></li>
                      <li><a href="#">Contacts</a></li>
                    </ul>
                  </div>
                </div>
                <div class="col-3 col-md-6 col-sm-6">
                  <div class="content">
                    <p><b>Help</b></p>
                    <ul class="footer-menu">
                      <li><a href="#">About us</a></li>
                      <li><a href="#">My profile</a></li>
                      <li><a href="#">Pricing plans</a></li>
                      <li><a href="#">Contacts</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- END FOOTER SECTION -->
      <script>
        const navAuth = document.getElementById("nav-auth");
        const loggedUser = JSON.parse(localStorage.loggedInUser);

        if (loggedUser && loggedUser.status) {
          navAuth.innerHTML = `
            <a href="profile.html" class="btn btn-hover">
              <span>Profile</span>
            </a>
            <button id="logout" class="btn-danger btn-danger-hover">
              <span>Logout</span>
            </button>
          `;

          document.getElementById("logout").addEventListener("click", function () {
            localStorage.removeItem("loggedInUser");
            window.location.href = "index.html"; // Ensure it works for all environments
          });
        }

        document.addEventListener("DOMContentLoaded", function () {
          const userData = JSON.parse(localStorage.getItem("loggedInUser"));

          if (!userData) {
            alert("No user data found! Please log in.");
            window.location.href = "index.html"; // Redirect if no user is logged in
            return;
          }

          // Display user info
          const username = document.getElementById("username");
          const profileImage = document.getElementById("profile-image");
          username.innerHTML = `@${userData.username}`;
          profileImage.src = userData.profileImage || "./images/profile-user.png";

          // Form fields
          const usernameForm = document.getElementById("username-form");
          const emailForm = document.getElementById("email-form");
          const passwordForm = document.getElementById("password-form");
          const confirmPasswordForm = document.getElementById("confirm_password_form");
          const editForm = document.getElementById("edit-form");

          // Pre-fill user data
          usernameForm.value = userData.username;
          emailForm.value = userData.email;
          passwordForm.value = userData.password;
          confirmPasswordForm.value = userData.password;

          // Handle form submission
          editForm.addEventListener("submit", function (event) {
            event.preventDefault();

            // Get updated values inside the event listener
            const updatedUsername = usernameForm.value.trim();
            const updatedEmail = emailForm.value.trim();
            const updatedPassword = passwordForm.value.trim();
            const confirmedPassword = confirmPasswordForm.value.trim();

            // Validate passwords match
            if (updatedPassword !== confirmedPassword) {
              alert("Passwords do not match!");
              return;
            }

            // Create updated user object
            const updatedUserData = {
              username: updatedUsername,
              email: updatedEmail,
              password: updatedPassword, // Now properly updated
              status: true,
              profileImage: userData.profileImage || "./images/profile-user.png",
            };

            // Update in localStorage
            localStorage.setItem("loggedInUser", JSON.stringify(updatedUserData));

            // Update users list in localStorage
            let users = JSON.parse(localStorage.getItem("users")) || [];
            users = users.map((user) =>
              user.username === userData.username ? updatedUserData : user
            );
            localStorage.setItem("users", JSON.stringify(users));

            alert("Profile updated successfully!");
            window.location.href = "profile.html"; // Redirect back to profile page
          });
        });


        // Faviorite Movies
        let cards_container = document.getElementById("cards-container");
        if(JSON.parse(localStorage.favorites).length != 0){
          JSON.parse(localStorage.favorites).forEach(element => {
            const options = {
              method: "GET",
              headers: {
                accept: "application/json",
                Authorization:
                  "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI4NjU2MTA2YzQzZWQ4YTE4MWY1NTQ1MWQyNzE1N2IwNSIsIm5iZiI6MTY1Mzc1MzI3Ni42NTEsInN1YiI6IjYyOTI0NWJjNWE0NjkwMDA5ZTQ1YzYyOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.dJVNpdz4E-lTr5XxqqUpbVkVRufZ_llITMvAPxrtxFw", // Replace with your actual TMDB API key
              },
            };
            fetch(`https://api.themoviedb.org/3/movie/${element}?language=en-US`, options)
            .then((response) => response.json())
            .then((data) => {
              cards_container.innerHTML += 
              `
              <div class="card">
                <img src="https://image.tmdb.org/t/p/w300${data.poster_path}" id="movie-banner" width="200px" alt="movie title">
                <a href="movie-details.html?id=${element}"><h2>${data.title}</h2></a>
              </div>  
            `;
            })
            .catch((error) => console.error("Error fetching movie details:", error));
          });
        }
        
</script>
</body>
</html>